{% extends "society/base.html" %}
{% load static %}
{% block content %}
<div class="container py-1">

    
    <div class="container mb-2">
        <div class="row">
            {% if request.user.is_superuser %}
            <div class="col-5">
                <a href="{% url 'create-new-feed' %}" class="btn btn-light">
                    Create Notice
                </a>
            </div>
            {% endif %}
            <div class="col">
                <h3 class="fw-bold">Notice Board</h3>
            </div>
        </div>
    </div>
   
  <!-- Scrollable feed area -->
  <div class="feed-wrapper" style="max-height: 75vh; overflow-y: auto; padding: 0 0.5rem;">
    {% if notices %}
      {% for n in notices %}
        <article class="p-3 rounded shadow-sm bg-white mb-3">
          <!-- Title + meta -->
          <div class="text-center mb-2">
            <h5 class="mb-1">{{ n.title }}</h5>
            <small class="text-muted">
              Publish By {{ n.crated_by.get_full_name }} 
              | {{ n.created_at|date:"M d, Y h:i A" }}
            </small>
          </div>

          <!-- Message (collapsible) -->
          {% if n.message %}
            <p class="mb-2 notice-text collapse" id="noticeText-{{ n.id }}">
              {{ n.message }}
            </p>
            <p class="mb-2 notice-text-clamped" id="noticeTextClamped-{{ n.id }}">
              {{ n.message }}
            </p>
            <div class="text-center">
              <button class="btn btn-link btn-sm p-0"
                      type="button"
                      data-expand-target="{{ n.id }}">
                Show more
              </button>
            </div>
          {% endif %}

          <!-- Optional image -->
          {% if n.image %}
            <div class="ratio ratio-16x9 rounded overflow-hidden mt-2">
              <img src="{{ n.image.url }}" class="w-100 h-100 object-fit-cover" loading="lazy" alt="Notice image">
            </div>
          {% endif %}
        </article>
      {% endfor %}
    {% else %}
      <div class="p-4 text-center text-muted">No notices yet.</div>
    {% endif %}
  </div>
</div>

<style>
  body {
    background-color: #f5f6f8; /* light page background visible between posts */
  }
  .notice-text-clamped {
    display: -webkit-box;
    -webkit-line-clamp: 3; /* number of lines before 'Show more' */
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: .25rem;
  }
  .object-fit-cover { object-fit: cover; }
  .hover-shadow-sm:hover { box-shadow: 0 .25rem .5rem rgba(0,0,0,.08) !important; }
  .feed-wrapper article {
    margin-bottom: 1rem; /* gap between posts */
  }
</style>

<script>
  // Toggle Show more / less per notice
  document.addEventListener('click', function (e) {
    const btn = e.target.closest('[data-expand-target]');
    if (!btn) return;

    const id = btn.getAttribute('data-expand-target');
    const full = document.getElementById('noticeText-' + id);
    const clamped = document.getElementById('noticeTextClamped-' + id);

    if (full.classList.contains('show')) {
      full.classList.remove('show');
      clamped.style.display = '';
      btn.textContent = 'Show more';
    } else {
      full.classList.add('show');
      clamped.style.display = 'none';
      btn.textContent = 'Show less';
    }
  });
</script>
{% endblock %}
